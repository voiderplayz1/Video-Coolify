<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>VFXAI â€” Make My Video Cool</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Rajdhani:wght@400;600;700&display=swap');
:root {
  --bg:#080c10; --s1:#0d1117; --s2:#111823;
  --b1:#1c2a3a; --b2:#243040;
  --cy:#4fc3f7; --gr:#69f0ae; --tx:#c8d8e8; --mu:#4a6070; --ac:#e8f4ff;
  --r:8px; --mono:'Share Tech Mono',monospace; --sans:'Rajdhani',sans-serif;
}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
html{height:100%}
body{background:var(--bg);color:var(--tx);font-family:var(--sans);min-height:100%;overflow-x:hidden;line-height:1.5}
body::before{content:'';position:fixed;inset:0;pointer-events:none;z-index:0;
  background:repeating-linear-gradient(0deg,transparent 0px,transparent 3px,rgba(0,0,0,.06) 3px,rgba(0,0,0,.06) 4px),
  radial-gradient(ellipse at 50% 0%,rgba(30,60,100,.18) 0%,transparent 65%)}

/* â”€â”€ POPUPS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.overlay{position:fixed;inset:0;z-index:9990;background:rgba(4,8,14,.97);
  display:flex;align-items:center;justify-content:center;padding:20px}
.overlay.hidden{display:none}
#dlOverlay{background:rgba(4,8,14,.88);backdrop-filter:blur(10px);z-index:9980;display:none}
#dlOverlay.open{display:flex}

.popup{background:var(--s1);border:1px solid var(--b2);border-radius:16px;
  padding:48px 40px 40px;max-width:440px;width:100%;text-align:center;position:relative;
  box-shadow:0 0 60px rgba(79,195,247,.06),0 24px 48px rgba(0,0,0,.6);
  animation:popIn .4s cubic-bezier(.22,1,.36,1)}
@keyframes popIn{from{opacity:0;transform:scale(.88) translateY(24px)}to{opacity:1;transform:none}}
.co{position:absolute;width:14px;height:14px;border-color:var(--cy);border-style:solid;opacity:.45}
.co.tl{top:12px;left:12px;border-width:2px 0 0 2px}
.co.tr{top:12px;right:12px;border-width:2px 2px 0 0}
.co.bl{bottom:12px;left:12px;border-width:0 0 2px 2px}
.co.br{bottom:12px;right:12px;border-width:0 2px 2px 0}
.eye{font-family:var(--mono);font-size:10px;color:var(--cy);letter-spacing:.3em;text-transform:uppercase;margin-bottom:18px;opacity:.7}
.popup h2{font-size:15px;font-weight:600;color:var(--ac);line-height:1.6;margin-bottom:6px}
.popup .sub{font-family:var(--mono);font-size:11px;color:var(--mu);margin-bottom:32px}
.dbtn{display:flex;align-items:center;gap:18px;width:100%;padding:18px 22px;
  background:var(--bg);border:1px solid var(--b2);border-radius:var(--r);cursor:pointer;
  margin-bottom:12px;transition:border-color .2s,background .2s,box-shadow .2s;
  text-align:left;color:var(--tx);font-family:var(--sans)}
.dbtn:hover{border-color:var(--cy);background:rgba(79,195,247,.04);box-shadow:0 0 20px rgba(79,195,247,.1)}
.dbtn .di{font-size:28px;flex-shrink:0}
.dbtn .dl{font-size:17px;font-weight:700;color:var(--ac)}
.dbtn .dd{font-size:11px;color:var(--mu);font-family:var(--mono);margin-top:3px}

.dl-popup{max-width:360px;padding:36px 32px 28px;text-align:left}
.dl-popup h3{font-size:20px;font-weight:700;color:var(--ac);margin-bottom:6px}
.dl-popup .ds{font-family:var(--mono);font-size:11px;color:var(--mu);margin-bottom:24px}
.dlopt{display:flex;align-items:center;gap:16px;width:100%;padding:15px 18px;
  background:var(--bg);border:1px solid var(--b2);border-radius:var(--r);cursor:pointer;
  margin-bottom:10px;transition:border-color .2s,background .2s;font-family:var(--sans);color:var(--tx)}
.dlopt:hover{border-color:var(--cy);background:rgba(79,195,247,.04)}
.dlopt .fmt{font-family:var(--mono);font-size:15px;font-weight:700;color:var(--cy);width:54px;flex-shrink:0}
.dlopt .fl{font-size:14px;font-weight:700;color:var(--ac)}
.dlopt .fd{font-size:11px;color:var(--mu);font-family:var(--mono);margin-top:2px}
.dlcancel{width:100%;padding:11px;background:transparent;border:1px solid var(--b1);
  border-radius:var(--r);color:var(--mu);font-family:var(--sans);font-size:13px;
  cursor:pointer;margin-top:4px;transition:border-color .2s}
.dlcancel:hover{border-color:var(--mu)}

/* â”€â”€ HEADER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
header{position:relative;z-index:10;display:flex;align-items:center;
  justify-content:space-between;padding:20px 40px;border-bottom:1px solid var(--b1)}
.logo{display:flex;align-items:center;gap:12px;font-family:var(--mono);font-size:15px;
  color:var(--ac);letter-spacing:.08em}
.pulse{width:8px;height:8px;border-radius:50%;background:var(--cy);
  box-shadow:0 0 8px var(--cy);animation:blink 1.8s ease-in-out infinite}
@keyframes blink{0%,100%{opacity:1}50%{opacity:.3}}
.htag{font-family:var(--mono);font-size:10px;color:var(--mu);letter-spacing:.15em}

/* â”€â”€ MAIN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.main{position:relative;z-index:1;max-width:780px;margin:0 auto;padding:56px 24px 80px}
.hero{margin-bottom:52px}
.hlabel{display:inline-flex;align-items:center;gap:8px;font-family:var(--mono);font-size:10px;
  color:var(--cy);letter-spacing:.2em;text-transform:uppercase;margin-bottom:18px;
  padding:5px 12px;border:1px solid rgba(79,195,247,.25);border-radius:100px;background:rgba(79,195,247,.05)}
.hlabel span{width:5px;height:5px;border-radius:50%;background:var(--cy);animation:blink 1.2s infinite}
.hero h1{font-size:clamp(36px,7vw,62px);font-weight:700;line-height:1.05;letter-spacing:-.02em;color:var(--ac);margin-bottom:16px}
.hero h1 em{color:var(--cy);font-style:normal}
.hero p{font-size:15px;color:var(--mu);max-width:500px;line-height:1.7}
.slabel{font-family:var(--mono);font-size:10px;color:var(--cy);letter-spacing:.2em;text-transform:uppercase;margin-bottom:10px;opacity:.7}

/* â”€â”€ UPLOAD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.upzone{position:relative;margin-bottom:20px;border:1.5px dashed var(--b2);border-radius:12px;
  padding:52px 32px;text-align:center;cursor:pointer;background:var(--s1);
  transition:border-color .25s,background .25s,box-shadow .25s;overflow:hidden}
.upzone::after{content:'';position:absolute;inset:0;pointer-events:none;
  background:radial-gradient(ellipse at 50% 0%,rgba(79,195,247,.05) 0%,transparent 70%);opacity:0;transition:opacity .3s}
.upzone:hover,.upzone.drag{border-color:var(--cy);background:rgba(79,195,247,.03);box-shadow:0 0 30px rgba(79,195,247,.08)}
.upzone:hover::after,.upzone.drag::after{opacity:1}
.upzone.has{border-style:solid;border-color:rgba(79,195,247,.4)}
.upzone input[type=file]{position:absolute;inset:0;opacity:0;cursor:pointer;width:100%;height:100%}
.upzone .uico{font-size:44px;margin-bottom:14px}
.upzone h3{font-size:18px;font-weight:700;color:var(--ac);margin-bottom:6px}
.upzone p{font-size:13px;color:var(--mu);font-family:var(--mono)}
.chip{display:none;margin-top:14px;font-family:var(--mono);font-size:12px;color:var(--cy);
  background:rgba(79,195,247,.1);border:1px solid rgba(79,195,247,.2);padding:6px 14px;border-radius:100px}

/* â”€â”€ CARD / TOGGLE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.card{background:var(--s1);border:1px solid var(--b1);border-radius:12px;padding:28px;margin-bottom:20px}
.ctitle{font-size:11px;font-weight:700;color:var(--cy);letter-spacing:.2em;margin-bottom:22px;
  text-transform:uppercase;font-family:var(--mono);opacity:.75}
.trow{display:flex;align-items:flex-start;justify-content:space-between;gap:20px}
.tlbl{font-size:15px;font-weight:700;color:var(--ac)}
.tdsc{font-size:12px;color:var(--mu);margin-top:4px;font-family:var(--mono);line-height:1.6;max-width:380px}
.tgl{flex-shrink:0;width:46px;height:24px;background:var(--b2);border-radius:100px;border:none;cursor:pointer;
  position:relative;transition:background .25s;outline:none}
.tgl::after{content:'';position:absolute;left:3px;top:3px;width:18px;height:18px;
  border-radius:50%;background:var(--mu);transition:transform .25s,background .25s}
.tgl.on{background:rgba(79,195,247,.25)}
.tgl.on::after{transform:translateX(22px);background:var(--cy)}
.aex{display:none;margin-top:20px;padding-top:20px;border-top:1px solid var(--b1)}
.aex.show{display:block}
.apick{position:relative;display:flex;align-items:center;gap:14px;padding:14px 18px;
  background:var(--bg);border:1px dashed var(--b2);border-radius:var(--r);cursor:pointer;
  width:100%;transition:border-color .2s;font-family:var(--sans);color:var(--tx)}
.apick:hover{border-color:var(--cy)}
.apick input{position:absolute;inset:0;opacity:0;cursor:pointer;width:100%;height:100%}
.apick .ai{font-size:22px}
.apick .al{font-size:14px;font-weight:700;color:var(--ac)}
.apick .as{font-size:11px;color:var(--mu);font-family:var(--mono);margin-top:2px}
#aname{display:none;margin-top:10px;font-family:var(--mono);font-size:11px;color:var(--cy)}

/* â”€â”€ SLIDERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.sgrid{display:grid;gap:24px}
.srow{display:flex;flex-direction:column;gap:8px}
.shdr{display:flex;justify-content:space-between;align-items:flex-start;gap:12px}
.sl{font-size:14px;font-weight:700;color:var(--ac)}
.sd{font-size:11px;color:var(--mu);font-family:var(--mono);margin-top:2px}
.sv{font-family:var(--mono);font-size:14px;color:var(--cy);flex-shrink:0;min-width:16px;text-align:right}
input[type=range]{-webkit-appearance:none;appearance:none;width:100%;height:3px;
  background:var(--b2);border-radius:100px;outline:none;cursor:pointer}
input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;width:16px;height:16px;
  border-radius:50%;background:var(--cy);cursor:pointer;box-shadow:0 0 6px rgba(79,195,247,.5);transition:box-shadow .2s}
input[type=range]::-webkit-slider-thumb:hover{box-shadow:0 0 14px rgba(79,195,247,.9)}
input[type=range]::-moz-range-thumb{width:16px;height:16px;border-radius:50%;border:none;
  background:var(--cy);cursor:pointer;box-shadow:0 0 6px rgba(79,195,247,.5)}

/* â”€â”€ CONVERT BUTTON â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#cvtBtn{width:100%;padding:19px;background:var(--s2);border:1.5px solid var(--b2);
  border-radius:var(--r);color:var(--ac);font-family:var(--sans);font-size:17px;font-weight:700;
  letter-spacing:.06em;text-transform:uppercase;cursor:pointer;position:relative;overflow:hidden;
  transition:border-color .25s,box-shadow .25s,background .25s;margin-bottom:28px}
#cvtBtn::before{content:'';position:absolute;inset:0;
  background:linear-gradient(90deg,transparent,rgba(79,195,247,.08),transparent);
  transform:translateX(-100%);transition:transform .7s}
#cvtBtn:not(:disabled):hover::before{transform:translateX(100%)}
#cvtBtn:not(:disabled):hover{border-color:var(--cy);box-shadow:0 0 30px rgba(79,195,247,.15),0 4px 20px rgba(0,0,0,.4);background:rgba(79,195,247,.05)}
#cvtBtn:disabled{opacity:.3;cursor:not-allowed}

/* â”€â”€ PROGRESS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#progSec{display:none;margin-bottom:28px}
#progSec.show{display:block}
.phdr{display:flex;justify-content:space-between;align-items:baseline;margin-bottom:8px}
.plbl{font-family:var(--mono);font-size:11px;color:var(--cy)}
.ppct{font-family:var(--mono);font-size:13px;color:var(--ac)}
.ptrk{height:2px;background:var(--b1);border-radius:100px;overflow:hidden;margin-bottom:16px}
.pfill{height:100%;width:0%;background:var(--cy);border-radius:100px;box-shadow:0 0 8px var(--cy);transition:width .3s}
.psteps{display:flex;gap:8px;flex-wrap:wrap}
.pc{font-family:var(--mono);font-size:10px;padding:3px 10px;border-radius:100px;
  border:1px solid var(--b2);color:var(--mu);transition:all .3s;letter-spacing:.05em}
.pc.on{border-color:var(--cy);color:var(--cy);background:rgba(79,195,247,.1)}
.pc.dn{border-color:transparent;color:var(--b2)}

/* â”€â”€ RESULT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#resSec{display:none}
#resSec.show{display:block}
.rcard{background:#000;border:1px solid var(--b2);border-radius:12px;overflow:hidden;box-shadow:0 0 40px rgba(79,195,247,.08)}
.rcard video{width:100%;display:block;max-height:500px;object-fit:contain;background:#000}
.ract{display:flex;gap:12px;padding:20px 24px;border-top:1px solid var(--b1);flex-wrap:wrap}
.btn1{flex:1;min-width:160px;padding:13px 20px;background:var(--cy);color:#050c14;border:none;
  border-radius:var(--r);font-family:var(--sans);font-size:14px;font-weight:700;
  letter-spacing:.06em;text-transform:uppercase;cursor:pointer;transition:opacity .2s,transform .2s}
.btn1:hover{opacity:.88;transform:translateY(-1px)}
.btn2{flex:1;min-width:160px;padding:13px 20px;background:transparent;color:var(--mu);
  border:1px solid var(--b2);border-radius:var(--r);font-family:var(--sans);font-size:14px;
  font-weight:600;letter-spacing:.04em;text-transform:uppercase;cursor:pointer;transition:border-color .2s,color .2s}
.btn2:hover{border-color:var(--ac);color:var(--tx)}

/* â”€â”€ NOTICE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.notice{display:flex;gap:10px;align-items:flex-start;padding:12px 16px;
  background:rgba(105,240,174,.04);border:1px solid rgba(105,240,174,.12);
  border-radius:var(--r);margin-bottom:20px;font-size:12px;color:var(--mu);
  font-family:var(--mono);line-height:1.6}
.notice .ni{color:var(--gr);flex-shrink:0}
.err-notice{background:rgba(255,80,80,.06);border-color:rgba(255,80,80,.2)}
.err-notice .ni{color:#ff6b6b}

/* â”€â”€ MOBILE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
body.mob header{padding:14px 16px}
body.mob .main{padding:32px 16px 60px}
body.mob .hero h1{font-size:34px}
body.mob .upzone{padding:40px 20px}
body.mob .card{padding:20px 16px}
body.mob .ract{flex-direction:column}
body.mob .btn1,body.mob .btn2{width:100%;flex:none}
body.mob .popup{padding:36px 20px 28px}
body.mob .dl-popup{padding:28px 18px 20px}
</style>
</head>
<body>

<!-- DEVICE POPUP -->
<div class="overlay" id="devOv">
  <div class="popup">
    <div class="co tl"></div><div class="co tr"></div><div class="co bl"></div><div class="co br"></div>
    <div class="eye">// SYSTEM INIT</div>
    <h2>hey! i just need you to answer this real quick,<br>this WILL CHANGE how you view the site!</h2>
    <div class="sub">select your device to continue_</div>
    <button class="dbtn" id="btnPC">
      <span class="di">ğŸ–¥ï¸</span>
      <div><div class="dl">PC / Laptop</div><div class="dd">full desktop experience</div></div>
    </button>
    <button class="dbtn" id="btnMob">
      <span class="di">ğŸ“±</span>
      <div><div class="dl">Mobile Device</div><div class="dd">touch-optimized layout</div></div>
    </button>
  </div>
</div>

<!-- DOWNLOAD POPUP -->
<div class="overlay" id="dlOverlay">
  <div class="popup dl-popup">
    <h3>Download Video</h3>
    <div class="ds">// output is webm Â· plays in chrome, firefox, edge, safari 16+_</div>
    <button class="dlopt" id="dlBtn">
      <span class="fmt">.WEBM</span>
      <div><div class="fl">WebM â€” VP8/VP9 + Opus audio</div><div class="fd">universal modern browser Â· full quality</div></div>
    </button>
    <button class="dlcancel" id="dlCancel">Cancel</button>
  </div>
</div>

<!-- HEADER -->
<header>
  <div class="logo"><div class="pulse"></div>VFX<span style="color:var(--cy)">AI</span></div>
  <div class="htag">NODE GRAPH OVERLAY v3.0</div>
</header>

<main class="main">
  <div class="hero">
    <div class="hlabel"><span></span> AI MOTION ANALYSIS</div>
    <h1>Make Your<br>Video <em>Cool</em></h1>
    <p>Upload any video and AI overlays a live neural-graph network â€” nodes spawn on every moving region, all connected with glowing lines. Every single frame, processed.</p>
  </div>

  <div class="slabel">// 01 &nbsp; UPLOAD VIDEO</div>
  <div class="upzone" id="upzone">
    <input type="file" id="vidIn" accept="video/mp4,video/quicktime,.mov,.mp4">
    <div class="uico">ğŸ“‚</div>
    <h3>Drop your video here</h3>
    <p>MP4 or MOV &nbsp;Â·&nbsp; any resolution</p>
    <div class="chip" id="chip"></div>
  </div>

  <div class="slabel">// 02 &nbsp; AUDIO (OPTIONAL)</div>
  <div class="card">
    <div class="ctitle">// AUDIO SETTINGS</div>
    <div class="trow">
      <div>
        <div class="tlbl">Replace Audio Track</div>
        <div class="tdsc">Swap out the original audio with your own file, trimmed to video length. Off = original audio is kept.</div>
      </div>
      <button class="tgl" id="audTgl"></button>
    </div>
    <div class="aex" id="aex">
      <button class="apick">
        <input type="file" id="audIn" accept="audio/*">
        <span class="ai">ğŸµ</span>
        <div><div class="al">Upload Audio Track</div><div class="as">MP3 Â· WAV Â· AAC Â· OGG</div></div>
      </button>
      <div id="aname"></div>
    </div>
  </div>

  <div class="slabel">// 03 &nbsp; EFFECT SETTINGS</div>
  <div class="card">
    <div class="ctitle">// OVERLAY PARAMETERS &nbsp;Â·&nbsp; 0 = off &nbsp;Â·&nbsp; 1 = default &nbsp;Â·&nbsp; 5 = max</div>
    <div class="sgrid">
      <div class="srow">
        <div class="shdr">
          <div><div class="sl">Movement Sensitivity</div><div class="sd">threshold for triggering nodes â€” lower threshold = more nodes on subtle movement</div></div>
          <div class="sv" id="vSens">1</div>
        </div>
        <input type="range" id="sSens" min="0" max="5" value="1" oninput="sy('Sens')">
      </div>
      <div class="srow">
        <div class="shdr">
          <div><div class="sl">Line Thickness</div><div class="sd">stroke width of connecting lines and node box outlines</div></div>
          <div class="sv" id="vThk">1</div>
        </div>
        <input type="range" id="sThk" min="0" max="5" value="1" oninput="sy('Thk')">
      </div>
      <div class="srow">
        <div class="shdr">
          <div><div class="sl">Line Glow</div><div class="sd">bloom / glow intensity on lines and nodes</div></div>
          <div class="sv" id="vGlo">1</div>
        </div>
        <input type="range" id="sGlo" min="0" max="5" value="1" oninput="sy('Glo')">
      </div>
      <div class="srow">
        <div class="shdr">
          <div><div class="sl">Line Imperfections</div><div class="sd">organic curve/wobble on connecting lines â€” 0 = straight, 5 = wild</div></div>
          <div class="sv" id="vImp">1</div>
        </div>
        <input type="range" id="sImp" min="0" max="5" value="1" oninput="sy('Imp')">
      </div>
    </div>
  </div>

  <div class="slabel">// 04 &nbsp; PROCESS</div>
  <div class="notice" id="noticeBox">
    <span class="ni">â„¹</span>
    <span id="noticeText">Requires Chrome 94+ or Edge 94+. Processing runs in real-time â€” a 30s video takes ~30s. Nothing is uploaded to any server.</span>
  </div>
  <button id="cvtBtn" disabled>â¬¡ &nbsp; Make My Video Cool</button>

  <div id="progSec">
    <div class="phdr">
      <span class="plbl" id="plbl">initializing...</span>
      <span class="ppct" id="ppct">0%</span>
    </div>
    <div class="ptrk"><div class="pfill" id="pfill"></div></div>
    <div class="psteps">
      <div class="pc" id="p1">AUDIO</div>
      <div class="pc" id="p2">DECODE</div>
      <div class="pc" id="p3">OVERLAY</div>
      <div class="pc" id="p4">ENCODE</div>
    </div>
  </div>

  <div id="resSec">
    <div class="slabel" style="margin-bottom:14px">// DONE â€” PREVIEW &amp; DOWNLOAD</div>
    <div class="rcard">
      <video id="resVid" controls playsinline></video>
    </div>
    <div class="ract">
      <button class="btn1" id="btnDl">â¬‡ &nbsp; Download</button>
      <button class="btn2" id="btnReset">â†© &nbsp; Convert Another</button>
    </div>
  </div>
</main>

<script type="module">
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   VFXAI v3.0 â€” WebCodecs engine
   requestVideoFrameCallback fires for every decoded frame.
   VideoEncoder explicitly encodes each frame â†’ true 30fps.
   No canvas.captureStream() â†’ no dropped frames, no empty files.
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

// â”€â”€ UI helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const $ = id => document.getElementById(id);
window.sy = k => { $('v'+k).textContent = $('s'+k).value; };

function prog(pct, lbl, step) {
  $('pfill').style.width = pct + '%';
  $('ppct').textContent  = Math.round(pct) + '%';
  $('plbl').textContent  = lbl;
  ['p1','p2','p3','p4'].forEach((id,i) => {
    $( id).className = 'pc' + (i < step ? ' dn' : i === step ? ' on' : '');
  });
}
const sleep = ms => new Promise(r => setTimeout(r, ms));
const fmt   = s => Math.floor(s/60)+':'+String(Math.floor(s%60)).padStart(2,'0');

// â”€â”€ Device â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
$('btnPC').onclick  = () => { $('devOv').classList.add('hidden'); };
$('btnMob').onclick = () => { $('devOv').classList.add('hidden'); document.body.classList.add('mob'); };

// â”€â”€ Files â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let vidFile = null, audFile = null, resultBlob = null, audOn = false;

const upzone = $('upzone');
upzone.addEventListener('dragover',  e => { e.preventDefault(); upzone.classList.add('drag'); });
upzone.addEventListener('dragleave', ()  => upzone.classList.remove('drag'));
upzone.addEventListener('drop', e => {
  e.preventDefault(); upzone.classList.remove('drag');
  if (e.dataTransfer.files[0]) setVid(e.dataTransfer.files[0]);
});
$('vidIn').onchange = () => { if ($('vidIn').files[0]) setVid($('vidIn').files[0]); };
function setVid(f) {
  vidFile = f;
  upzone.classList.add('has');
  const c = $('chip'); c.style.display = 'inline-block'; c.textContent = 'âœ“ ' + f.name;
  $('cvtBtn').disabled = false;
}
$('audTgl').onclick = () => {
  audOn = !audOn;
  $('audTgl').classList.toggle('on', audOn);
  $('aex').classList.toggle('show', audOn);
};
$('audIn').onchange = () => {
  const f = $('audIn').files[0]; if (!f) return;
  audFile = f;
  $('aname').style.display = 'block'; $('aname').textContent = 'âœ“ ' + f.name;
};

// â”€â”€ Settings â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const gs = () => ({
  sens:  +$('sSens').value,
  thick: +$('sThk').value,
  glow:  +$('sGlo').value,
  imp:   +$('sImp').value,
});

// â”€â”€ Convert â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
$('cvtBtn').onclick = startConvert;
async function startConvert() {
  if (!vidFile) return;
  $('cvtBtn').disabled = true;
  $('resSec').classList.remove('show');
  $('progSec').classList.add('show');
  prog(1, 'checking browser support...', 0);
  try {
    resultBlob = await processVideo(vidFile, audOn ? audFile : null, gs());
    prog(100, 'complete!', 4);
    await sleep(300);
    showResult(resultBlob);
  } catch(err) {
    console.error(err);
    const nb = $('noticeBox');
    nb.className = 'notice err-notice';
    $('noticeText').textContent = 'âš  ' + err.message;
    prog(0, 'failed', 0);
    $('progSec').classList.remove('show');
    $('cvtBtn').disabled = false;
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CORE ENGINE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function processVideo(srcFile, replaceAudioFile, S) {

  // â”€â”€ Support checks â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  if (!window.VideoEncoder)
    throw new Error('WebCodecs not supported. Use Chrome 94+, Edge 94+, or Safari 17+.');
  if (!HTMLVideoElement.prototype.requestVideoFrameCallback)
    throw new Error('requestVideoFrameCallback not supported. Use Chrome 83+ or Edge 83+.');

  // â”€â”€ Load source video â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const srcURL  = URL.createObjectURL(srcFile);
  const vid     = document.createElement('video');
  vid.src       = srcURL; vid.muted = true; vid.playsInline = true;
  await waitMeta(vid);
  const W = vid.videoWidth, H = vid.videoHeight, DUR = vid.duration;

  // â”€â”€ Drawing canvas (output) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const canvas  = document.createElement('canvas');
  canvas.width  = W; canvas.height = H;
  const ctx     = canvas.getContext('2d', { willReadFrequently: false });

  // â”€â”€ Small canvas for motion detection (32Ã—32) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const DS      = 32;
  const dsC     = document.createElement('canvas');
  dsC.width     = DS; dsC.height = DS;
  const dsCtx   = dsC.getContext('2d', { willReadFrequently: true });

  // â”€â”€ Detect best codec â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const { vCodec, mCodec } = await pickCodec(W, H);

  // â”€â”€ Import webm-muxer â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  prog(4, 'loading muxer...', 0);
  const { Muxer, ArrayBufferTarget } = await import(
    'https://cdn.jsdelivr.net/npm/webm-muxer@3.0.3/dist/webm-muxer.mjs'
  );

  // â”€â”€ Pre-encode audio â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  prog(6, 'encoding audio...', 0);
  let audioMeta = null;
  try {
    audioMeta = await encodeAudio(replaceAudioFile || srcFile, DUR);
  } catch(e) {
    console.warn('Audio encoding failed, continuing without audio:', e);
  }

  // â”€â”€ Muxer â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const muxTarget = new ArrayBufferTarget();
  const muxCfg = {
    target: muxTarget,
    video : { codec: mCodec, width: W, height: H, frameRate: 30 },
    firstTimestampBehavior: 'offset',
  };
  if (audioMeta) {
    muxCfg.audio = { codec:'A_OPUS', sampleRate: audioMeta.sampleRate, numberOfChannels: audioMeta.channels };
  }
  const muxer = new Muxer(muxCfg);

  // â”€â”€ Add all audio chunks first (before video) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  if (audioMeta) {
    for (const { chunk, meta } of audioMeta.chunks) {
      muxer.addAudioChunk(chunk, meta);
    }
  }

  // â”€â”€ VideoEncoder â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const videoChunks = [];
  const vEnc = new VideoEncoder({
    output: (chunk, meta) => videoChunks.push({ chunk, meta }),
    error : e => { throw new Error('VideoEncoder: ' + e.message); },
  });
  vEnc.configure({
    codec             : vCodec,
    width             : W,
    height            : H,
    bitrate           : Math.max(4_000_000, Math.min(20_000_000, W * H * 30 * 0.1)),
    framerate         : 30,
    latencyMode       : 'quality',
  });

  // â”€â”€ Node graph state â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  let prevDS  = null;
  let nodes   = [];
  let nId     = 0;
  let fi      = 0;

  prog(12, 'starting playback...', 1);

  // â”€â”€ requestVideoFrameCallback loop â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // This fires for EVERY decoded frame â€” not tied to display refresh.
  await new Promise((resolve, reject) => {
    let resolved = false;

    function onFrame(now, meta) {
      try {
        // 1. Draw source frame
        ctx.drawImage(vid, 0, 0, W, H);

        // 2. Motion detection at 32Ã—32
        dsCtx.drawImage(vid, 0, 0, DS, DS);
        const px = dsCtx.getImageData(0, 0, DS, DS).data;

        if (prevDS) {
          const spots = detectMotion(px, prevDS, DS, S.sens);
          nId = spawnNodes(nodes, spots, nId, W, H, DS, S);
          ageNodes(nodes, px, prevDS, DS, W, H);
          drawGraph(ctx, nodes, W, H, S);
          nodes = nodes.filter(n => n.life > 0.01);
        }
        prevDS = new Uint8ClampedArray(px);

        // 3. Encode frame via WebCodecs
        const ts = Math.round(meta.mediaTime * 1_000_000); // Âµs
        const vf = new VideoFrame(canvas, { timestamp: ts, duration: 33_334 });
        vEnc.encode(vf, { keyFrame: fi % 60 === 0 });
        vf.close();

        fi++;
        const pct = 12 + (meta.mediaTime / DUR) * 80;
        prog(pct, `frame ${fi} Â· ${fmt(meta.mediaTime)} / ${fmt(DUR)}`,
          meta.mediaTime < DUR * 0.33 ? 1 : meta.mediaTime < DUR * 0.75 ? 2 : 3);

      } catch(err) { if (!resolved) { resolved = true; reject(err); } return; }

      if (!vid.ended && meta.mediaTime < DUR - 0.04) {
        vid.requestVideoFrameCallback(onFrame);
      } else {
        if (!resolved) { resolved = true; resolve(); }
      }
    }

    vid.requestVideoFrameCallback(onFrame);
    vid.onerror = e => { if (!resolved) { resolved = true; reject(new Error('Video load failed')); } };
    vid.play().catch(e => { if (!resolved) { resolved = true; reject(e); } });
  });

  prog(93, 'flushing encoder...', 3);
  await vEnc.flush();
  vEnc.close();

  // â”€â”€ Add video chunks to muxer â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  prog(96, 'muxing...', 3);
  for (const { chunk, meta } of videoChunks) {
    muxer.addVideoChunk(chunk, meta);
  }
  muxer.finalize();

  const buf = muxTarget.buffer;
  if (!buf || buf.byteLength < 1000)
    throw new Error('Output file is empty â€” try a different browser or shorter video.');

  return new Blob([buf], { type: 'video/webm' });
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CODEC DETECTION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function pickCodec(W, H) {
  const candidates = [
    { vCodec: 'vp09.00.10.08', mCodec: 'V_VP9' },
    { vCodec: 'vp8',           mCodec: 'V_VP8' },
  ];
  for (const c of candidates) {
    try {
      const r = await VideoEncoder.isConfigSupported({ codec: c.vCodec, width: W, height: H });
      if (r.supported) return c;
    } catch {}
  }
  throw new Error('No supported video codec. Try Chrome or Edge.');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   AUDIO ENCODING  (decode file â†’ resample to 48kHz â†’ Opus)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function encodeAudio(srcFile, maxDuration) {
  if (!window.AudioEncoder || !window.AudioData)
    throw new Error('AudioEncoder not available');

  // Decode audio
  const ACx   = window.AudioContext || window.webkitAudioContext;
  const actx  = new ACx();
  const ab    = await srcFile.arrayBuffer();
  let buf     = await actx.decodeAudioData(ab).catch(e => { throw new Error('audio decode failed: '+e.message); });

  // Resample to 48kHz (Opus requires 8/12/16/24/48kHz)
  const TARGET_SR = 48000;
  const channels  = Math.min(2, buf.numberOfChannels);
  if (buf.sampleRate !== TARGET_SR) {
    const maxSamp = Math.ceil(Math.min(buf.duration, maxDuration) * TARGET_SR);
    const oac     = new OfflineAudioContext(channels, maxSamp, TARGET_SR);
    const src     = oac.createBufferSource();
    src.buffer    = buf;
    src.connect(oac.destination);
    src.start();
    buf = await oac.startRendering();
  }

  const maxSamples = Math.floor(Math.min(buf.duration, maxDuration) * buf.sampleRate);
  const CHUNK      = 4096;
  const chunks     = [];

  const enc = new AudioEncoder({
    output: (chunk, meta) => chunks.push({ chunk, meta }),
    error : e => console.warn('AudioEncoder:', e),
  });
  enc.configure({ codec: 'opus', sampleRate: TARGET_SR, numberOfChannels: channels, bitrate: 128_000 });

  for (let off = 0; off < maxSamples; off += CHUNK) {
    const len  = Math.min(CHUNK, maxSamples - off);
    const data = new Float32Array(channels * len);
    for (let c = 0; c < channels; c++) {
      data.set(buf.getChannelData(c).subarray(off, off + len), c * len);
    }
    const ad = new AudioData({
      format: 'f32-planar', sampleRate: TARGET_SR,
      numberOfChannels: channels, numberOfFrames: len,
      timestamp: Math.round(off / TARGET_SR * 1_000_000),
      data,
    });
    enc.encode(ad);
    ad.close();
  }
  await enc.flush();
  enc.close();

  return { chunks, sampleRate: TARGET_SR, channels };
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MOTION DETECTION  â€” CPU diff on 32Ã—32 grid
   Returns array of {x,y} in VIDEO space (0..W, 0..H)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function detectMotion(curr, prev, DS, sensitivity) {
  // Map sensitivity 0-5 â†’ diff threshold (lower = more sensitive)
  const THRESH = [58, 40, 28, 18, 11, 6][sensitivity] ?? 40;

  const cells = [];
  for (let gi = 0; gi < DS * DS; gi++) {
    const p = gi * 4;
    const dc = Math.abs(
      (0.299 * curr[p] + 0.587 * curr[p+1] + 0.114 * curr[p+2]) -
      (0.299 * prev[p] + 0.587 * prev[p+1] + 0.114 * prev[p+2])
    );
    if (dc > THRESH) cells.push({ gi, score: dc });
  }
  cells.sort((a, b) => b.score - a.score);
  // Max nodes: sensitivity 0â€“5 â†’ 4..28
  const maxN = [4, 8, 12, 18, 24, 32][sensitivity] ?? 8;
  return cells.slice(0, maxN).map(c => ({
    gx: c.gi % DS, gy: Math.floor(c.gi / DS), score: c.score
  }));
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   NODE MANAGEMENT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
// Label variety matching the video (hex, decimal, var names, code fragments)
const LABEL_GEN = [
  ()  => '0x' + Math.floor(Math.random()*256).toString(16).toUpperCase().padStart(2,'0'),
  ()  => '0x' + Math.floor(Math.random()*65536).toString(16).toUpperCase().padStart(4,'0'),
  ()  => (Math.random()*999+10).toFixed(1),
  ()  => 'var_' + Math.floor(Math.random()*0xFF).toString(16),
  ()  => ['int','f32','u8','ptr','ref'][Math.floor(Math.random()*5)] + '_' + Math.floor(Math.random()*99),
  ()  => Math.floor(Math.random()*9999).toString(),
];

function spawnNodes(nodes, spots, nId, W, H, DS, S) {
  const CELL  = W / DS; // cell width in video px
  const CELH  = H / DS;
  const MDIST2 = (CELL * 1.5) ** 2;

  for (const sp of spots) {
    // Convert grid coords to video coords with small jitter
    const vx = (sp.gx + 0.5 + (Math.random() - .5) * 0.4) * CELL;
    const vy = (sp.gy + 0.5 + (Math.random() - .5) * 0.4) * CELH;

    // Check if a node already lives nearby
    let found = false;
    for (const n of nodes) {
      const dx = n.x - vx, dy = n.y - vy;
      if (dx*dx + dy*dy < MDIST2) {
        n.life = Math.min(1, n.life + 0.18); // refresh it
        found = true; break;
      }
    }
    if (!found) {
      nodes.push({
        id    : nId++,
        x     : vx, y: vy,
        life  : 0.9,
        label : LABEL_GEN[Math.floor(Math.random() * LABEL_GEN.length)](),
        seed  : Math.random() * 1000,
        score : sp.score,
      });
    }
  }
  return nId;
}

function ageNodes(nodes, curr, prev, DS, W, H) {
  const CELL = W / DS, CELH = H / DS;
  const t    = performance.now() * 0.0008;

  for (const n of nodes) {
    n.life -= 0.025;
    // Micro drift
    n.x += Math.sin(n.seed + t)     * 0.25;
    n.y += Math.cos(n.seed * 1.3 + t) * 0.25;
    // Boost life if underlying pixel is still moving
    const gx = Math.max(0, Math.min(DS-1, Math.floor(n.x / CELL)));
    const gy = Math.max(0, Math.min(DS-1, Math.floor(n.y / CELH)));
    const p  = (gy * DS + gx) * 4;
    const dc = Math.abs(
      (0.299 * curr[p] + 0.587 * curr[p+1] + 0.114 * curr[p+2]) -
      (0.299 * prev[p] + 0.587 * prev[p+1] + 0.114 * prev[p+2])
    );
    if (dc > 15) n.life = Math.min(1, n.life + 0.04);
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DRAW NODE GRAPH â€” matching the video exactly:
   full mesh (every node â†’ every other), rectangle markers,
   hex labels, glowing white lines
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function drawGraph(ctx, nodes, W, H, S) {
  const live = nodes.filter(n => n.life > 0.04 && n.x > 0 && n.x < W && n.y > 0 && n.y < H);
  if (live.length < 2) return;

  // Map settings 0â€“5 to real values
  const LW  = [0.0, 0.7, 1.2, 1.9, 2.7, 3.8][S.thick] ?? 0.7;  // line width
  const GLO = [0,   4,   9,  15,  22,  32 ][S.glow]  ?? 4;    // shadow blur px
  const IMP = [0,  12,  28,  50,  80, 130 ][S.imp]   ?? 12;   // bezier offset px
  const now = performance.now();

  ctx.save();

  // â”€â”€ LINES: full mesh (every node to every other) â”€â”€â”€â”€â”€â”€â”€â”€â”€
  for (let i = 0; i < live.length; i++) {
    for (let j = i + 1; j < live.length; j++) {
      const a = live[i], b = live[j];
      const alpha = Math.min(a.life, b.life) * 0.78;
      if (alpha < 0.04 || LW === 0) continue;

      ctx.save();
      ctx.globalAlpha  = alpha;
      ctx.strokeStyle  = '#ffffff';
      ctx.lineWidth    = LW;
      if (GLO > 0) { ctx.shadowBlur = GLO; ctx.shadowColor = 'rgba(210,235,255,.95)'; }

      ctx.beginPath();
      ctx.moveTo(a.x, a.y);

      if (IMP > 0) {
        // Animated organic bezier curve â€” matches video's slightly wobbly lines
        const cx = (a.x + b.x) * 0.5 + Math.sin((a.seed + b.seed) * .5 + now * .0006) * IMP;
        const cy = (a.y + b.y) * 0.5 + Math.cos((a.seed + b.seed) * .7 + now * .0008) * IMP;
        ctx.quadraticCurveTo(cx, cy, b.x, b.y);
      } else {
        ctx.lineTo(b.x, b.y);
      }
      ctx.stroke();
      ctx.restore();
    }
  }

  // â”€â”€ NODES: rectangle + center dot + hex label â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  for (const n of live) {
    const alpha = n.life;
    const rw = 7, rh = 5; // rectangle half-size

    ctx.save();
    ctx.globalAlpha = alpha;
    if (GLO > 0) { ctx.shadowBlur = GLO * 1.4; ctx.shadowColor = 'rgba(210,235,255,.98)'; }

    // Outer rectangle (hollow, like in the video)
    if (LW > 0) {
      ctx.strokeStyle = '#ffffff';
      ctx.lineWidth   = Math.max(0.6, LW * 0.6);
      ctx.strokeRect(n.x - rw, n.y - rh, rw * 2, rh * 2);
    }

    // Center dot
    ctx.shadowBlur = 0;
    ctx.fillStyle  = 'rgba(255,255,255,.9)';
    ctx.beginPath();
    ctx.arc(n.x, n.y, Math.max(1, LW * 0.7 + 0.5), 0, Math.PI * 2);
    ctx.fill();

    // Hex label (tiny monospace, above the rectangle, like in the video)
    if (GLO > 0) { ctx.shadowBlur = GLO * .5; ctx.shadowColor = 'rgba(200,230,255,.7)'; }
    ctx.font      = '8px "Share Tech Mono",monospace';
    ctx.fillStyle = 'rgba(210,235,255,.82)';
    ctx.fillText(n.label, n.x - rw, n.y - rh - 3);

    ctx.restore();
  }

  ctx.restore();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   UTILS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function waitMeta(el) {
  return new Promise((res, rej) => {
    if (el.readyState >= 1) { res(); return; }
    el.onloadedmetadata = res; el.onerror = rej; el.load();
  });
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RESULT + DOWNLOAD
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function showResult(blob) {
  $('resVid').src = URL.createObjectURL(blob);
  $('progSec').classList.remove('show');
  $('resSec').classList.add('show');
  $('resSec').scrollIntoView({ behavior: 'smooth', block: 'start' });
  $('cvtBtn').disabled = false;
}

$('btnDl').onclick  = () => $('dlOverlay').classList.add('open');
$('dlCancel').onclick = () => $('dlOverlay').classList.remove('open');
$('dlOverlay').onclick = e => { if (e.target === $('dlOverlay')) $('dlOverlay').classList.remove('open'); };
$('dlBtn').onclick = () => {
  if (!resultBlob) return;
  $('dlOverlay').classList.remove('open');
  const a = document.createElement('a');
  a.href = URL.createObjectURL(resultBlob);
  a.download = 'vfxai-output.webm';
  document.body.appendChild(a); a.click(); document.body.removeChild(a);
};

$('btnReset').onclick = () => {
  vidFile = null; audFile = null; resultBlob = null; audOn = false;
  $('vidIn').value = ''; $('audIn').value = '';
  $('aname').style.display = 'none';
  $('audTgl').classList.remove('on');
  $('aex').classList.remove('show');
  upzone.classList.remove('has');
  $('chip').style.display = 'none';
  $('progSec').classList.remove('show');
  $('resSec').classList.remove('show');
  $('resVid').src = '';
  $('cvtBtn').disabled = true;
  const nb = $('noticeBox');
  nb.className = 'notice';
  $('noticeText').textContent = 'Requires Chrome 94+ or Edge 94+. Processing runs in real-time â€” a 30s video takes ~30s. Nothing is uploaded to any server.';
  window.scrollTo({ top: 0, behavior: 'smooth' });
};

// Expose resultBlob for download button
const origStart = startConvert;
$('cvtBtn').onclick = async () => {
  if (!vidFile) return;
  $('cvtBtn').disabled = true;
  $('resSec').classList.remove('show');
  $('progSec').classList.add('show');
  prog(1, 'checking browser support...', 0);
  try {
    resultBlob = await processVideo(vidFile, audOn ? audFile : null, gs());
    prog(100, 'complete!', 4);
    await sleep(300);
    showResult(resultBlob);
  } catch(err) {
    console.error(err);
    const nb = $('noticeBox');
    nb.className = 'notice err-notice';
    $('noticeText').textContent = 'âš  ' + err.message;
    prog(0, 'failed', 0);
    $('progSec').classList.remove('show');
    $('cvtBtn').disabled = false;
  }
};
</script>
</body>
</html>
